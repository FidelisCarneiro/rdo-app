<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RDO - Fidel</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="./css/styles.css">
  <meta name="theme-color" content="#C8102E"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#C8102E"/><path d="M6 13l3 3 9-9" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <h1>RDO - Fidel</h1>
    </div>
    <nav id="nav">
      <a data-tab="#tab-auth" class="active">Login</a>
      <a data-tab="#tab-dashboard">Dashboard</a>
      <a data-tab="#tab-rdo">Novo RDO</a>
      <a data-tab="#tab-lists">Cadastros</a>
      <button id="btnPrint" class="btn ghost">Imprimir / PDF</button>
      <button id="btnSignOut" class="btn ghost" style="display:none">Sair</button>
    </nav>
  </header>

  <main>
    <div id="toast"></div>

    <section id="tab-auth" class="card">
      <h2>Autenticação</h2>
      <div class="grid cols-2">
        <form id="formSignIn" class="card">
          <h3>Entrar</h3>
          <label>E-mail</label><input id="inEmail" type="email" required>
          <label>Senha</label><input id="inPass" type="password" required>
          <div class="actions"><button class="btn primary">Entrar</button></div>
          <div class="hint">Use um e-mail de teste no ambiente dev.</div>
        </form>
        <form id="formSignUp" class="card">
          <h3>Criar conta</h3>
          <label>Nome</label><input id="upNome" required>
          <label>E-mail</label><input id="upEmail" type="email" required>
          <label>Telefone</label><input id="upTel" type="tel">
          <label>Senha</label><input id="upPass" type="password" required>
          <div class="actions"><button class="btn secondary">Cadastrar</button></div>
        </form>
      </div>
    </section>

    <section id="tab-dashboard" class="card" style="display:none">
      <h2>Dashboard</h2>
      <div class="row cols-4">
        <div>
          <label>Projeto</label>
          <select id="filtroObra"></select>
        </div>
        <div>
          <label>Data inicial</label>
          <input id="filtroIni" type="date">
        </div>
        <div>
          <label>Data final</label>
          <input id="filtroFim" type="date">
        </div>
        <div class="actions" style="align-items:end">
          <button class="btn primary" id="btnAplicarFiltros">Aplicar filtros</button>
        </div>
      </div>
      <div class="grid cols-2" style="margin-top:12px">
        <canvas id="chartHH"></canvas>
        <canvas id="chartOcorr"></canvas>
      </div>
      <div class="grid cols-3" style="margin-top:12px">
        <div class="card"><h3>Efetivo Dia</h3><div id="kpiEfetivo" class="badge">—</div></div>
        <div class="card"><h3>HH (30 dias)</h3><div id="kpiHH" class="badge">—</div></div>
        <div class="card"><h3>Ocorrencias (30 dias)</h3><div id="kpiOcorr" class="badge">—</div></div>
      </div>
    </section>

    <section id="tab-rdo" class="card" style="display:none">
      <h2>Novo RDO</h2>
      <div class="row cols-4">
        <div><label>Obra</label><select id="rdoObra"></select></div>
        <div><label>Nº RDO</label><input id="rdoNumero" placeholder="ex.: 004"/></div>
        <div><label>Data</label><input id="rdoData" type="date" required/></div>
        <div style="align-self:end"><span id="rdoDow" class="badge">—</span></div>
      </div>

      <div class="row cols-4" style="margin-top:8px">
        <div><label>Hora de chegada ao campo</label><input id="horaChegada" type="time" required/></div>
        <div>
          <label>Teve PTS?</label>
          <div class="actions">
            <label class="pill"><input type="radio" name="pts" value="nao" checked/> Nao</label>
            <label class="pill"><input type="radio" name="pts" value="sim"/> Sim</label>
          </div>
        </div>
        <div><label>Numero do PTS</label><input id="ptsNumero" placeholder="se aplicavel" disabled/></div>
        <div><label>Hora abertura PTS</label><input id="ptsAbertura" type="time" disabled/></div>
      </div>
      <div class="row cols-3">
        <div><label>Hora inicio do trabalho</label><input id="horaInicioTrab" type="time" required/></div>
        <div class="cols-2" style="grid-column: span 2"><label>Atividades do dia</label><textarea id="atividadesDia" placeholder="Descreva atividades realizadas" required></textarea></div>
      </div>

      <div class="card">
        <h3>Condições climáticas</h3>
        <div class="row cols-4">
          <div>
            <label>Manhã</label>
            <select id="climaManha">
              <option value="">—</option>
              <option>Seco</option>
              <option>Chuvas leves</option>
              <option>Chuvas fortes</option>
              <option>Ventos fortes</option>
            </select>
          </div>
          <div>
            <label>Tarde</label>
            <select id="climaTarde">
              <option value="">—</option>
              <option>Seco</option>
              <option>Chuvas leves</option>
              <option>Chuvas fortes</option>
              <option>Ventos fortes</option>
            </select>
          </div>
          <div>
            <label>Noite</label>
            <select id="climaNoite">
              <option value="">—</option>
              <option>Seco</option>
              <option>Chuvas leves</option>
              <option>Chuvas fortes</option>
              <option>Ventos fortes</option>
            </select>
          </div>
          <div class="actions" style="align-items:end"><button id="btnClima" type="button" class="btn ghost">Preencher automaticamente (GPS)</button></div>
        </div>
      </div>

      <div class="card">
        <h3>Horas por colaborador</h3>
        <div class="row cols-4">
          <div><label>Colaborador</label><select id="hhColab"></select></div>
          <div><label>Atividade</label><select id="hhAtividade"></select></div>
          <div><label>Horas (HH:MM)</label><input id="hhHoras" type="time" step="60" value="00:00"></div>
          <div class="actions" style="align-items:end"><button id="btnAddHH" class="btn secondary" type="button">Adicionar</button></div>
        </div>
        <table id="tblHH" style="margin-top:8px"><thead><tr><th>Colaborador</th><th>Atividade</th><th>Horas</th><th></th></tr></thead><tbody></tbody></table>
      </div>

      <div class="grid cols-2">
        <div class="card">
          <h3>Ocorrencias</h3>
          <label>Tipo</label>
          <select id="occTipo">
            <option value="chuva">Chuvas</option><option value="vento">Ventos</option><option value="atraso_material">Atraso de material</option>
            <option value="falha_equip">Falha de equipamento</option><option value="energia">Falta de energia</option><option value="acidente">Acidente</option>
            <option value="greve">Greve/Paralisacao</option><option value="raios">Raios</option><option value="retrabalho">Retrabalho</option><option value="outros">Outros</option>
          </select>
          <label>Descricao</label><textarea id="occDesc"></textarea>
          <label>Colaboradores envolvidos</label><select id="occColabs" multiple></select>
          <label>Prazo impactado (HH:MM)</label><input id="occPrazo" type="time" step="60" value="00:00">
          <div class="actions"><button id="btnAddOcc" type="button" class="btn ghost">Adicionar</button></div>
          <ul id="occLista" class="hint"></ul>
        </div>
        <div class="card">
          <h3>Assinatura Digital</h3>
          <canvas id="sigPad" width="400" height="180" style="border:1px dashed #ddd;border-radius:8px;background:#fff"></canvas>
          <div class="actions"><button id="btnClearSig" type="button" class="btn ghost">Limpar</button></div>
          <div class="hint">Assine com o mouse ou toque. A imagem sera salva no RDO.</div>
        </div>
      </div>

      <div class="grid cols-2">
        <div class="card">
          <h3>Equipamentos utilizados</h3>
          <div class="row cols-4">
            <div><label>Equipamento</label><select id="eqEquip"></select></div>
            <div><label>Motorista</label><select id="eqMotorista"></select></div>
            <div><label>Horimetro/Km inicial</label><input id="eqHini" type="number" step="0.1"></div>
            <div><label>Horimetro/Km final</label><input id="eqHfim" type="number" step="0.1"></div>
          </div>
          <div class="actions" style="margin-top:6px"><button id="btnAddEq" class="btn ghost" type="button">Adicionar equipamento</button></div>
          <table id="tblEq" style="margin-top:8px"><thead><tr><th>Equipamento</th><th>Motorista</th><th>Ini</th><th>Fim</th><th></th></tr></thead><tbody></tbody></table>
        </div>
        <div class="card">
          <h3>Materiais</h3>
          <div class="row cols-4">
            <div><label>Material</label><select id="matItem"></select></div>
            <div><label>Acao</label><select id="matAcao"><option value="recebido">Recebido</option><option value="utilizado">Utilizado</option></select></div>
            <div><label>Quantidade</label><input id="matQtde" type="number" step="0.01"></div>
            <div><label>Unidade</label><input id="matUnid" placeholder="ex.: un, kg, m"></div>
          </div>
          <div class="actions" style="margin-top:6px"><button id="btnAddMat" class="btn ghost" type="button">Adicionar material</button></div>
          <table id="tblMat" style="margin-top:8px"><thead><tr><th>Material</th><th>Acao</th><th>Qtde</th><th>Unid</th><th></th></tr></thead><tbody></tbody></table>
        </div>
      </div>

      <div class="grid cols-2">
        <div class="card">
          <h3>Fotos</h3>
          <label>Fotos de atividades (min 1 se houver HH)</label>
          <input id="fotosAtv" type="file" accept="image/*" multiple>
          <label>Fotos de ocorrencias (min 1 se houver ocorrencias)</label>
          <input id="fotosOcc" type="file" accept="image/*" multiple>
        </div>
        <div class="card">
          <h3>NFC - Vincular Colaborador</h3>
          <div class="actions"><button id="btnNFC" type="button" class="btn ghost">Ler cracha NFC</button><span id="nfcStatus" class="badge">Aguardando...</span></div>
          <div class="hint">Chrome/Android com Web NFC habilitado.</div>
          <h3 style="margin-top:16px">Resumo</h3>
          <label>Materiais / Observacoes</label><textarea id="rdoResumo"></textarea>
        </div>
      </div>

      <div class="footerbar">
        <button id="btnSalvarRDO" class="btn primary">Salvar RDO</button>
      </div>
    </section>

    <section id="tab-lists" class="card" style="display:none">
      <h2>Cadastros</h2>
      <div class="grid cols-3">
        <div class="card">
          <h3>Obras</h3>
          <label>Nome</label><input id="obraNome">
          <label>Gestor</label><input id="obraGestor">
          <label>Escopo</label><input id="obraEscopo">
          <label>Nº Contrato</label><input id="obraContrato">
          <label>Data Inicio</label><input id="obraInicio" type="date">
          <label>Assinatura</label><input id="obraAssin" type="date">
          <label>Previsao Conclusao</label><input id="obraPrev" type="date">
          <label>Valor</label><input id="obraValor" type="number" step="0.01">
          <label>Resp. Tecnico</label><input id="obraResp">
          <label>Nº ART</label><input id="obraART">
          <div class="actions"><button id="btnAddObra" class="btn secondary">Adicionar</button></div>
          <div id="listaObras" class="empty">Sem obras</div>
        </div>
        <div class="card">
          <h3>Colaboradores</h3>
          <label>Nome</label><input id="colabNome">
          <label>Funcao</label><input id="colabFuncao">
          <label>E-mail</label><input id="colabEmail" type="email">
          <label>Telefone</label><input id="colabTel">
          <div class="actions"><button id="btnAddColab" class="btn secondary">Adicionar</button></div>
          <div id="listaColabs" class="empty">Sem colaboradores</div>
        </div>
        <div class="card">
          <h3>Atividades</h3>
          <label>Obra</label><select id="ativObra"></select>
          <label>Nome da atividade</label><input id="ativNome">
          <label>ID do cronograma</label><input id="ativCrono">
          <label>Prazo (dias)</label><input id="ativPrazo" type="number">
          <div class="actions"><button id="btnAddAtiv" class="btn secondary">Adicionar</button></div>
          <div id="listaAtivs" class="empty">Sem atividades</div>
        </div>
      </div>

      <div class="grid cols-2" style="margin-top:16px">
        <div class="card">
          <h3>Equipamentos</h3>
          <label>Nome</label><input id="eqcNome">
          <label>Marca</label><input id="eqcMarca">
          <label>Modelo</label><input id="eqcModelo">
          <label>Data</label><input id="eqcData" type="date">
          <label>Horimetro/Km</label><input id="eqcHKm" type="number" step="0.1">
          <label>Motorista (colaborador)</label><select id="eqcMotorista"></select>
          <div class="actions"><button id="btnAddEquip" class="btn secondary">Adicionar</button></div>
          <div id="listaEquip" class="empty">Sem equipamentos</div>
        </div>
        <div class="card">
          <h3>Materiais</h3>
          <label>Nome</label><input id="matcNome">
          <label>Unidade</label><input id="matcUnid" placeholder="ex.: un, kg, m">
          <div class="actions"><button id="btnAddMatCad" class="btn secondary">Adicionar</button></div>
          <div id="listaMatCad" class="empty">Sem materiais</div>
        </div>
      </div>
    </section>
  </main>

  <script defer src="./js/app.js"></script>
</body>
</html>
